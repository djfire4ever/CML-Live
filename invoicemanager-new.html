<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Manager</title>
  <style>
  </style>
</head>
<body class="theme-dark">
<div class="watermark"></div>
<!-- Notification Toasts -->

<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

<!-- Loader -->
<div id="loadingOverlay" class="d-none">
  <div class="text-center text-info">
      <div class="spinner-border text-info" role="status"></div>
      <p class="mt-2">Loading... Please wait...</p>
  </div>
</div>

<!-- Invoice Management Section -->
<section class="text-center text-sm-start">
  <div class="container">
    <h2 class="text-center">Invoice Management</h2>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs" id="invoiceTabs">
  <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-search">üîç Search Invoice</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-view">‚úèÔ∏è View Invoice</button></li>
  <!-- <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#payments" style="display:none;">Payments</button></li> -->
</ul>

<!-- Search Template -->
<template id="rowTemplate">
  <tr class="result-box">
    <th class="invoiceID" scope="row"></th>
    <th class="invoiceDate"></th>
    <th class="firstName"></th>
    <th class="lastName"></th>
    <th class="amountDue"></th>
  </tr>
</template>

<!-- Tab Content -->
<div class="tab-content">
      
<!-- üîç Search Invoices -->
<div class="tab-pane fade show active" id="tab-search">
  <div class="input-group">
    <input type="text" class="form-control" id="searchInput" placeholder="üîç search...">
      <div class="input-group-append">
        <span class="input-group-text" id="searchCounter">üîç</span> 
      </div>
  </div>
  <table class="table table-hover my-custom-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Invoice Date</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Amount Due</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="searchResults"></tbody>
</table>
</div>

<!-- ‚úèÔ∏è View Invoice -->
<div class="container">
<div class="tab-pane fade" id="payments-tab">
    <form id="paymentsForm">
    <input type="hidden" id="view-logID">
      <div class="row g-3">
        <div class="col-sm-1"><label><b>#</b></label><input type="text" class="form-control" id="invoiceID" readonly></div>
        <div class="col-sm-2"><label><b>First Name</b></label><input type="text" class="form-control" id="firstName" readonly></div>
        <div class="col-sm-2"><label><b>First Name</b></label><input type="text" class="form-control" id="firstName" readonly></div>
        <div class="col-sm-3"><label><b>Last Name</b></label><input type="text" class="form-control" id="lastName" readonly></div>
        <div class="col-sm-2"><label><b>Amount Due</b></label><input type="text" class="form-control" id="amountDue" readonly></div>
      </div>
      <div class="row g-3">
        <div class="d-grid gap-0 d-sm-block mt-3">
          <div>
            <button type="button" class="btn btn-dark" id="view-Button">View PDF</button>
            <button type="button" class="btn btn-dark" id="send-Button">Email PDF</button>
        </div>
      </div>
    </div>
              
<!-- Final Invoice Email Modal -->
<div class="row g-3 mt-3 mb-5">
  <div class="modal fade" id="finalInvoiceModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Send Final Invoice</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="invoice-email-to" class="form-label">To:</label>
            <input type="email" class="form-control" id="invoice-email-to" readonly>
          </div>
          <div class="mb-3">
            <label for="invoice-email-subject" class="form-label">Subject:</label>
            <input type="text" class="form-control" id="invoice-email-subject">
          </div>
          <div class="mb-3">
            <label for="invoice-email-body" class="form-label">Email Body:</label>
            <div id="invoice-email-body" contenteditable="true" class="form-control" style="height: 200px; overflow-y: auto;"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="openLogPaymentModal('INV-00123')" class="btn btn-outline-success btn-sm">Log Payment</button>
          <button id="send-invoice-email" class="btn btn-primary">Send Invoice Email</button>
          <button id="send-invoice-email-btn" class="btn btn-primary">Send Email</button>
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Log Payment Modal -->
<div class="modal fade" id="logPaymentModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Log Invoice Payment</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="logPaymentForm">
          <input type="hidden" id="log-payment-invoiceID">
          <div class="mb-3">
            <label for="log-payment-amount" class="form-label">Amount Received</label>
            <input type="number" class="form-control" id="log-payment-amount" min="0.01" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="log-payment-method" class="form-label">Payment Method</label>
            <select class="form-select" id="log-payment-method" required>
              <option value="">Choose...</option>
              <option value="Cash">Cash</option>
              <option value="Zelle">Zelle</option>
              <option value="Venmo">Venmo</option>
              <option value="CashApp">Cash App</option>
              <option value="Check">Check</option>
              <option value="Card">Card</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-text text-muted">Partial payments are supported. Balance will update accordingly.</div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="submitLogPaymentBtn" class="btn btn-success">Log Payment</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

</section>

<!-- <script> -->

<script>

function setupDynamicNavigation() {
  function activateTabFromHash() {
    var hash = window.location.hash;
    if (!hash) return;

    var targetTabButton = document.querySelector('[data-bs-target="' + hash + '"]');
    if (targetTabButton) {
      var tab = new bootstrap.Tab(targetTabButton);
      tab.show();
    }
  }

  // Use window.onload for full page load
  window.onload = function() {
    activateTabFromHash();  // Ensures tab switch happens after everything is loaded
  };

  window.addEventListener('hashchange', activateTabFromHash);
}

setupDynamicNavigation();

</script>

<script src="config.js"></script>
<script src="invoicemanager-new.js"></script>

<!-- </script> -->

</body>
</html>
