<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="quote-manager.css">
  <title>QuoteManager 2.0</title>
</head>
<style>

</style>

<body class="project-theme">
<!-- â³ Loader -->
<div id="loadingOverlay" class="d-none">
  <div class="text-center">
    <div class="spinner-border text-info" role="status"></div>
    <p class="mt-4 loader-message text-info">Loading... Please wait...</p>
  </div>
</div>
<!-- For VS Code CSS analysis: .step.active .circle, .step.filled .circle -->
<template style="display:none;">
  <div class="step active"><div class="circle"></div></div>
  <div class="step filled"><div class="circle"></div></div>
</template>

<div class="container py-4">
  <div class="quote-container d-flex flex-column" style="height: 80vh;">

    <!-- Navigation Buttons (fixed at bottom of container) -->
    <div class="btn-group d-flex justify-content-between m-2 align-items-center">
      <button class="btn btn-sm prevBtn" style="flex: 0 0 100px;">Back</button>

      <!-- Step Indicators -->
      <div class="step-nav mb-1 d-flex gap-2">
        <div class="step active">
          <div class="circle">Client</div>
        </div>
        <div class="step">
          <div class="circle">Event</div>
        </div>
        <div class="step">
          <div class="circle">Products</div>
        </div>
        <div class="step">
          <div class="circle">Other</div>
        </div>
        <div class="step">
          <div class="circle">Finalize</div>
        </div>
      </div>

      <button class="btn btn-sm nextBtn" style="flex: 0 0 100px;">Next</button>
    </div>

    <!-- Progress Bar -->
    <div class="progress border border-info">
      <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
    </div>

  <!-- Carousel -->
    <div id="quoteCarousel" class="carousel slide flex-grow-1" data-bs-interval="false">
      <div class="carousel-inner">

      <!-- Slide 1: Client Info -->
      <div class="carousel-item active" id="slide1">
        <div class="project-theme slide-inner p-3">
          <h4 class="glow-title">Client Information</h4>

          <!-- Client Info Fieldset -->
          <fieldset id="clientInfoFieldset" class="mb-2 p-2">
            <div class="d-flex flex-wrap justify-content-start align-items-start gap-3">

              <!-- Left Column: Icon + Names + Tier -->
              <div id="clientIconColumn"
                  class="position-relative d-flex flex-column justify-content-center align-items-center ps-1 pe-3 rounded shadow"
                  style="width:200px; min-height:220px; overflow:hidden; background:rgba(255,255,255,0.02);">
                <i class="bi bi-award tier-icon-bg position-absolute"
                  style="font-size:12rem; opacity:0.45; z-index:0;"></i>

                <div class="position-relative z-1 w-100 mt-2 d-flex flex-column justify-content-center align-items-center text-warning">
                  <div class="mb-1 text-center w-100">
                    <span class="firstName d-block mb-1 fw-bold fs-6"></span>
                  </div>
                  <div class="mb-1 text-center w-100">
                    <span class="nickName d-block mb-1 fw-bold fs-6"></span>
                  </div>
                  <div class="mb-1 text-center w-100">
                    <span class="lastName d-block fw-bold fs-6"></span>
                  </div>
                </div>

                <div class="mt-auto w-100 px-1 mb-1 text-center text-warning">
                  <span class="tier" data-tier-id="0"></span>
                </div>
              </div>

              <!-- Right Column: Contact & Address -->
              <div id="clientDetailsColumn" class="d-flex flex-column flex-grow-1" style="width:220px;">
                <div class="row gx-2 gy-2 text-warning">

                  <!-- Phone (editable search input) -->
                  <div class="col-md-6">
                    <label class="form-label text-info mb-0">Phone</label>
                    <div class="position-relative">
                      <input type="search" class="clientID-input" placeholder="Search phone or name">
                      <ul class="client-suggestions"></ul>
                    </div>
                  </div>

                  <!-- Email -->
                  <div class="col-md-6">
                    <label class="form-label text-info mb-0">Email</label>
                    <span class="email d-block"></span>
                  </div>

                  <!-- Street -->
                  <div class="col-md-12">
                    <label class="form-label text-info mb-0">Street</label>
                    <span class="street d-block"></span>
                  </div>

                  <!-- City / State / Zip -->
                  <div class="col-md-6">
                    <label class="form-label text-info mb-0">City</label>
                    <span class="city d-block"></span>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label text-info mb-0">State</label>
                    <span class="state d-block"></span>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label text-info mb-0">Zip</label>
                    <span class="zip d-block"></span>
                  </div>

                  <!-- Member Since -->
                  <div class="col-md-6">
                    <label class="form-label text-info mb-0">Member Since</label>
                    <span class="memberSince d-block"></span>
                  </div>

                  <!-- Birthday -->
                  <div class="col-md-4">
                    <label class="form-label text-info mb-0">Birthday</label>
                    <span class="birthday d-block"></span>
                  </div>

                </div>
              </div>

            </div>
          </fieldset>
        </div>
      </div>

      <!-- Slide 2: Event -->
      <div class="carousel-item" id="slide2">
        <h4 class="glow-title mb-3">Event Details</h4>

        <!-- First Row: Event Date + Location -->
        <div class="row mb-2 g-2">
          <div class="col-3">
            <div class="event-tile d-flex align-items-center gap-2 project-theme project-theme-tile">
              <i class="bi bi-calendar-event tile-icon"></i>
              <div class="flex-fill">
                <label for="eventDate" class="tile-label">Event Date</label>
                <input type="date" id="eventDate" class="tile-input">
              </div>
            </div>
          </div>
          <div class="col-9">
            <div class="event-tile d-flex align-items-center gap-2 project-theme project-theme-tile">
              <i class="bi bi-geo-alt tile-icon"></i>
              <div class="flex-fill">
                <label for="eventLocation" class="tile-label">Location</label>
                <textarea id="eventLocation" class="tile-input" rows="1" placeholder="Where is it happening?"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Second Row: Due Date + Theme -->
        <div class="row mb-2 g-2">
          <div class="col-3">
            <div class="event-tile d-flex align-items-center gap-2 project-theme project-theme-tile">
              <i class="bi bi-hourglass-split tile-icon"></i>
              <div class="flex-fill">
                <label for="dueDate" class="tile-label">Due Date</label>
                <input type="date" id="dueDate" class="tile-input">
              </div>
            </div>
          </div>
          <div class="col-9">
            <div class="event-tile d-flex align-items-center gap-2 project-theme project-theme-tile">
              <i class="bi bi-palette tile-icon"></i>
              <div class="flex-fill">
                <label for="eventTheme" class="tile-label">Theme</label>
                <textarea id="eventTheme" class="tile-input" rows="1" placeholder="Optional theme"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Third Row: Notes -->
        <div class="row g-2">
          <div class="col-12">
            <div class="event-tile d-flex align-items-start gap-2 project-theme project-theme-tile">
              <i class="bi bi-pencil-square tile-icon mt-2"></i>
              <div class="flex-fill">
                <label for="eventNotes" class="tile-label">Notes</label>
                <textarea id="eventNotes" class="tile-input" rows="2" placeholder="Add details here..."></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 3: Products -->
      <div class="carousel-item" id="slide3">
        <div class="slide3-header">
          <h4 class="glow-title mb-1">Products</h4>
          <div id="productSummaryCard" class="product-summary-card" title="Click for details">
            <div class="summary-line text-warning">
              <span class="count">0 items</span>
              <span class="total">$0.00</span>
            </div>
          </div>
        </div>

        <!-- Product Grid -->
        <div class="product-grid"></div>

        <!-- Overlay Form -->
        <div id="product-overlay" class="product-overlay d-none">
          <div class="product-form-card">
            <h5 class="glow-title mb-3" id="overlay-title">Add Product</h5>

          <!-- Product Name -->
          <input type="search" class="productName-input" placeholder="Search products">
          <ul class="product-suggestions"></ul>

            <!-- Cost / Retail Row -->
            <div class="row g-2 mt-1 align-items-end">
              <div class="col-3 text-info">Cost $</div>
              <div class="col-3 text-warning">
                <span id="costPrice">0.00</span>
              </div>
              <div class="col-3 text-info">Retail $</div>
              <div class="col-3 text-warning">
                <span id="retailPrice">0.00</span>
              </div>
            </div>

            <!-- Qty + Totals -->
            <div class="mt-3 border-top border-info pt-2">
              <div class="row g-2 align-items-center">
                <div class="col-1">
                  <label class="form-label text-info">Qty</label>
                </div>
                <div class="col-2">
                  <input type="number" id="qty" class="form-control bg-black text-warning border-info" min="1" value="1">
                </div>
                <div class="col-8">
                  <div class="d-flex justify-content-between text-warning">
                    <span>Total Cost:</span>
                    <span id="totalProductCost">$0.00</span>
                  </div>
                  <div class="d-flex justify-content-between text-warning">
                    <span>Total Retail:</span>
                    <span id="totalProductRetail">$0.00</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="row g-2 mt-3 overlay-btn-group">
              <div class="col">
                <button id="closeProduct" class="btn w-100">Add & Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 4: Other -->
      <div class="carousel-item" id="slide4">
        <h4 class="glow-title mb-3">Other</h4>

        <!-- Tiles Row -->
        <div class="row g-3">
          <div class="col-md-4">
            <div class="fees-tile project-theme-tile p-3 d-flex flex-column align-items-center justify-content-center text-center" title="Click for details">
              <div class="title fw-bold mb-1">Add-On Fees</div>
              <div class="total text-warning fw-bold" id="addonsTotalSummary">$0.00</div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="balance-tile project-theme-tile p-3 d-flex flex-column align-items-center justify-content-center text-center" title="Click for details">
              <div class="title fw-bold mb-1">Balance Details</div>
              <div class="total text-warning fw-bold" id="balanceDueSummary">$0.00</div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="discount-tile project-theme-tile p-3 d-flex flex-column align-items-center justify-content-center text-center" title="Click for details">
              <div class="title fw-bold mb-1">Discount</div>
              <div class="total text-warning fw-bold" id="discountSummary">0%</div>
            </div>
          </div>
        </div>

        <!-- Quote Notes -->
        <div class="row g-2 mt-3">
          <div class="col-12">
            <div id="quoteNotesCard" class="project-theme project-theme-tile p-3">
              <label for="quoteNotes" class="text-warning mb-1">Quote Notes</label>
              <textarea class="form-control" id="quoteNotes" rows="3" placeholder="Add optional notes for this quote..."></textarea>
            </div>
          </div>
        </div>

        <!-- Overlays -->
        <div class="fees-overlay d-none">
          <div class="overlay-card mx-auto" style="max-width: 300px;">
            <h5 class="glow-title mb-3">Add-On Fees</h5>
            <div class="row g-2 align-items-center">
              <div class="col-6"><label for="deliveryFee" class="mb-0">Delivery Fee</label></div>
              <div class="col-6"><input type="number" class="form-control" id="deliveryFee" min="0" value="0"></div>
            </div>
            <div class="row g-2 align-items-center">
              <div class="col-6"><label for="setupFee" class="mb-0">Setup Fee</label></div>
              <div class="col-6"><input type="number" class="form-control" id="setupFee" min="0" value="0"></div>
            </div>
            <div class="row g-2 align-items-center">
              <div class="col-6"><label for="otherFee" class="mb-0">Other Fee</label></div>
              <div class="col-6"><input type="number" class="form-control" id="otherFee" min="0" value="0"></div>
            </div>
            <div class="row g-2 align-items-center mt-2">
              <div class="col-6 fw-bold">Total:</div>
              <div class="col-6 text-warning fw-bold" id="addonsTotal">$0.00</div>
            </div>
            <div class="row g-2 mt-3 overlay-btn-group">
              <div class="col"><button id="saveAddOnFees" class="btn w-100">Save</button></div>
            </div>
          </div>
        </div>

        <div class="balance-overlay d-none">
          <div class="overlay-card mx-auto" style="width: 90%; max-width: 600px;">
            <h5 class="glow-title mb-3">Edit Balance Details</h5>
            <div class="row g-4">
              <div class="col-md-6">
                <div class="row g-2 align-items-center">
                  <div class="col-6"><label for="depositDate" class="mb-0">Deposit Date</label></div>
                  <div class="col-6"><input type="text" class="form-control" id="depositDate"></div>
                  <div class="col-6"><label for="paymentMethod" class="mb-0">Method</label></div>
                  <div class="col-6">
                    <select class="form-control" id="paymentMethod">
                      <option value="">Select a payment method</option>
                      <option value="Cash">Cash</option>
                      <option value="CashApp">CashApp</option>
                      <option value="Credit Card">Credit Card</option>
                      <option value="Zelle">Zelle</option>
                      <option value="Venmo">Venmo</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div class="col-6"><label for="balanceDueDate" class="mb-0">Balance Due Date</label></div>
                  <div class="col-6"><input type="text" class="form-control" id="balanceDueDate"></div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="row g-2 align-items-center">
                  <div class="col-6"><label for="deposit" class="mb-0">Deposit Amount</label></div>
                  <div class="col-6"><input type="number" class="form-control" id="deposit" min="0" value="0"></div>
                  <div class="col-6"><label for="amountPaid" class="mb-0">Amount Paid</label></div>
                  <div class="col-6"><input type="number" class="form-control" id="amountPaid" min="0" value="0"></div>
                  <div class="col-6 fw-bold text-warning">Balance Due</div>
                  <div class="col-6 fw-bold text-info" id="balanceDue">$0.00</div>
                </div>
              </div>
            </div>
            <div class="row g-2 mt-4 overlay-btn-group">
              <div class="col"><button id="saveBalanceDetails" class="btn w-100">Save</button></div>
            </div>
          </div>
        </div>

        <div class="discount-overlay d-none">
          <div class="overlay-card mx-auto" style="max-width: 300px;">
            <h5 class="glow-title mb-3">Discount</h5>
            <div class="row g-2 align-items-center">
              <div class="col-8"><label for="discount" class="mb-0">Discount (%)</label></div>
              <div class="col-4"><input type="number" class="form-control" id="discount" min="0" max="100" value="0"></div>
            </div>
            <div class="row g-2 align-items-center mt-1">
              <div class="col-8 fw-bold">After Discount</div>
              <div class="col-4 text-warning fw-bold" id="discountedTotal">$0.00</div>
            </div>
            <div class="row g-2 mt-3 overlay-btn-group">
              <div class="col"><button id="saveDiscount" class="btn w-100">Save</button></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Slide 5: Finalize -->
      <div class="carousel-item" id="slide5">
        <h4 class="glow mb-3">Finalize</h4>
        <p>Coming soon...</p>
      </div>

    </div>
  </div>

    <!-- Drawer Buttons (visible on main pane) -->
    <div class="btn-group mt-2 mt-auto m-2 pt-3 border-top border-info">
      <button class="btn" style="flex: 0 0 150px;" id="openQuoteSummary">Quote Summary</button>
      <button class="btn" style="flex: 0 0 150px;" id="openRunningTotal">Running Total</button>
      <button class="btn" style="flex: 0 0 150px;" id="openInvoicePreview">Invoice Preview</button>
      <button class="btn" style="flex: 0 0 150px;" id="openShoppingList">Shopping List</button> <!-- ðŸ›’ -->
    </div>

<!-- === Offcanvas Drawers === -->

<!-- Quote Summary Drawer (Final Layout) -->
<div class="offcanvas offcanvas-end bg-black text-info" style="width: 500px;" tabindex="-1" id="quoteSummaryDrawer">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Quote Summary</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>

  <div class="offcanvas-body">

    <!-- ================= CLIENT ================= -->
    <h6 class="mt-2 pb-1 border-bottom border-info fw-bold">Client</h6>

    <!-- Row 1: Name | ClientID -->
    <div class="d-flex justify-content-between mb-1">
      <span id="summaryClientName" class="text-warning">â€”</span>
      <span id="summaryClientID" class="text-warning">â€”</span>
    </div>

    <!-- Row 2: Member Since | Tier -->
    <div class="d-flex justify-content-between mb-3">
      <span>Member Since: <span id="summaryMemberSince" class="text-warning">â€”</span></span>
      <span>Tier: <span id="summaryTier" class="text-warning">â€”</span></span>
    </div>


    <!-- ================= EVENT ================= -->
    <h6 class="mt-5 pb-1 border-bottom border-info fw-bold">Event</h6>

    <div class="d-flex justify-content-between mb-1">
      <span>Date:</span>
      <span id="summaryEventDate" class="text-warning">â€”</span>
    </div>

    <div class="d-flex justify-content-between mb-1">
      <span>Location:</span>
      <span id="summaryEventLocation" class="text-warning">â€”</span>
    </div>

    <div class="d-flex justify-content-between mb-3">
      <span>Theme:</span>
      <span id="summaryEventTheme" class="text-warning">â€”</span>
    </div>

    <!-- ================= QUOTE TOTALS ================= -->
    <h6 class="mt-5 pb-1 border-bottom border-info fw-bold">Quote Totals</h6>

    <!-- Row 1: Product Count | @ Total Retail -->
    <div class="d-flex justify-content-between mb-1">
      <span>Product(s): <span id="summaryProductCount" class="text-warning">â€”</span></span>
      <span class="text-warning">@ <span id="summaryProductTotal">â€”</span></span>
    </div>

    <!-- Row 2: Discount % | Discounted Total -->
    <div class="d-flex justify-content-between mb-1">
      <span>Discount: <span id="summaryDiscount" class="text-warning">â€”</span></span>
      <span id="summaryDiscountedTotal" class="text-warning">â€”</span>
    </div>

    <!-- Row 3: Paid to Date | Amount -->
    <div class="d-flex justify-content-between mb-1">
      <span>Paid to Date:</span>
      <span id="summaryPaidToDate" class="text-warning">â€”</span>
    </div>

    <!-- Row 4: Grand Total (emphasized) -->
    <div class="d-flex justify-content-between mt-2">
      <span class="fw-bold">Grand Total:</span>
      <span id="summaryGrandTotal" class="fw-bold fs-5 text-warning">â€”</span>
    </div>

  </div>
</div>

<!-- Running Totals Drawer -->
<div class="offcanvas offcanvas-end bg-black text-info" style="width: 500px;" tabindex="-1" id="runningTotalDrawer">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Running Total</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>

  <div class="offcanvas-body" id="runningTotalBody">

    <div class="receipt">

      <!-- receipt header -->
      <div class="receipt-header">
        <p id="rt-generated-date">Generated:</p>
      </div>

      <!-- products list -->
      <div class="receipt-products" id="rt-products">
        <!-- product rows injected here -->
      </div>

      <!-- subtotals -->
      <div class="receipt-subtotals">
        <div><span>Total Product Retail:</span> <span id="rt-product-total">$0.00</span></div>
        <div><span>Sales Tax ( 8.875% ):</span> <span id="rt-tax">$0.00</span></div>
        <div><span>Discount (<span id="rt-discount-rate">0</span>):</span> <span id="rt-discount">$0.00</span></div>
        <div><span>After Discount:</span> <span id="rt-after-discount">$0.00</span></div>
      </div>

      <!-- addons -->
      <div class="receipt-addons">
        <div><span>Delivery:</span> <span id="rt-delivery">$0.00</span></div>
        <div><span>Setup:</span> <span id="rt-setup">$0.00</span></div>
        <div><span>Other:</span> <span id="rt-other">$0.00</span></div>
        <div><span>Add-ons Total:</span> <span id="rt-addons-total">$0.00</span></div>
      </div>

      <!-- totals -->
      <div class="receipt-total">
        <div><strong>Grand Total:</strong> <span id="rt-grand-total">$0.00</span></div>
        <div><span>Deposit:</span> <span id="rt-deposit">$0.00</span></div>
        <div><strong>Balance Due:</strong> <span id="rt-balance-due">$0.00</span></div>
      </div>

      <!-- footer -->
      <div class="receipt-footer">
        <p>Thank you for your business!</p>
      </div>

    </div>

  </div>
</div>

<!-- Invoice Preview Drawer -->
<div class="offcanvas offcanvas-end bg-black text-info" style="width: 600px;" tabindex="-1" id="invoiceDrawer">
  <div class="offcanvas-header d-flex justify-content-between align-items-center">
    <h5 class="offcanvas-title">Invoice Preview</h5>
    <div class="d-flex gap-2">
      <button class="btn btn-sm" id="printInvoiceBtn">Print</button>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
  </div>
  <div class="offcanvas-body" id="invoiceBody">
    <div id="invoicePrintArea"></div>
    <!-- injectInvoiceIntoDrawer() inserts invoice here -->
  </div>
</div>

<!-- Shopping List Drawer -->
<div class="offcanvas offcanvas-end bg-black text-info" style="width: 700px;" tabindex="-1" id="shoppingListDrawer">
  <div class="offcanvas-header">
  <h5 class="offcanvas-title">ðŸ›’ Shopping List of Materials for this quote</h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body p-0">
    <table class="table table-dark table-striped m-0">
      <thead>
        <tr>
          <th>Material</th>
          <th class="text-center">Needed</th>
          <th class="text-center">In Stock</th>
          <th class="text-center">Status</th>
          <th>Supplier</th>
          <th class="text-center">Reorder</th>
        </tr>
      </thead>
    <tbody id="shoppinglist-body"></tbody>
    </table>
  </div>
</div>

<!-- Debug Quote Button -->
<div class="container py-4">
<button id="debugQuoteBtn" class="btn bg-info text-black btn-sm" style="position: fixed; bottom: 10px; left: 10px; z-index: 10000;">
  Console Log currentQuote
</button>
</div>

<!-- === Scripts === -->
<script type="module" src="admin.js"></script>
<script type="module" src="quote-manager.js"></script>

</body>
</html>
