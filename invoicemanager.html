<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Manager</title>
  <style>
  </style>
</head>
<body class="theme-dark">
<div class="watermark"></div>
<!-- Notification Toasts -->

<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

<!-- Loader -->
<div id="loadingOverlay" class="d-none">
  <div class="text-center text-info">
      <div class="spinner-border text-info" role="status"></div>
      <p class="mt-2">Loading... Please wait...</p>
  </div>
</div>

<!-- Invoice Management Section -->
<section class="text-center text-sm-start">
<div class="container" data-element="main-container">
  <h2 class="text-center" data-element="page-title">Invoice Management</h2>


  <!-- Navigation Tabs -->
<ul class="nav nav-tabs" id="invoiceTabs">
  <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-search">üîç Search Invoice</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-view" style="display:none;">‚úèÔ∏è View Invoice</button></li>
  <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-payments">üí∞ Payments</button></li>
</ul>

<!-- Search Template -->
<template id="rowTemplate">
  <tr class="result-box">
    <th class="invoiceID" scope="row"></th>
    <th class="invoiceDate"></th>
    <th class="firstName"></th>
    <th class="lastName"></th>
    <th class="grandTotal"></th>
  </tr>
</template>

<!-- Tab Content -->
<div class="tab-content">

<!-- üîç Search Invoices -->
<div class="tab-pane fade show active" id="tab-search">
  <div class="input-group my-3">
    <input type="text" class="form-control" id="searchInput" placeholder="üîç search...">
      <div class="input-group-append">
        <span class="input-group-text" id="searchCounter">üîç</span>
      </div>
  </div>
  <table class="table table-hover my-custom-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Invoice Date</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Amount Due</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="searchResults"></tbody>
  </table>
</div>

<!-- ‚úèÔ∏è View Invoice -->
<div class="tab-pane fade" id="tab-view">
  <form id="invoiceView" class="my-4">
    <input type="hidden" id="view-logID">
    <input type="hidden" id="view-qtID">
    <input type="hidden" id="invoiceID">
    <div class="row g-3 mt-1 mb-1">
      <div class="col-md-2 col-lg-2"><label for="invoiceDate"><b>Invoice Date</b></label><input type="text" class="form-control" id="invoiceDate" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="dueDate"><b>Due Date</b></label><input type="text" class="form-control" id="dueDate"></div>

      <div class="col-md-2 col-lg-2"><label for="firstName"><b>First Name</b></label><input type="text" class="form-control" id="firstName" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="lastName"><b>Last Name</b></label><input type="text" class="form-control" id="lastName" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="email"><b>email</b></label><input type="text" class="form-control" id="email" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="grandTotal"><b>Amount Due</b></label><input type="text" class="form-control" id="grandTotal" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="amountPaid"><b>Amount Paid</b></label><input type="text" class="form-control" id="amountPaid" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="balanceDue"><b>Balance Due</b></label><input type="text" class="form-control" id="balanceDue" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="status"><b>Status</b></label><input type="text" class="form-control" id="status" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="paymentHistory"><b>Payment History</b></label><input type="text" class="form-control" id="paymentHistory" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="sendDate"><b>Send Date</b></label><input type="text" class="form-control" id="sendDate" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="sendMethod"><b>Send Method</b></label><input type="text" class="form-control" id="sendMethod" readonly></div>
      <div class="col-md-2 col-lg-2"><label for="invoiceLogNotes"><b>Log Notes</b></label><input type="text" class="form-control" id="invoiceLogNotes"></div>
    </div>
    <div class="row g-3 mt-1 mb-1">
      <div class="d-grid gap-2 d-sm-block mt-3">
        <button type="button" class="btn btn-warning" id="viewQuoteBtn">üìù View Quote</button>
        <button id="recordPaymentBtn" class="btn btn-primary">Record Payment</button>
      </div>
    </div>
    <div id="overdueAlert" class="alert alert-warning mt-2" style="display: none;">
      ‚ö†Ô∏è This invoice is overdue and still has a balance due.
    </div>
    <div id="paidInFullAlert" class="alert alert-success mt-2" style="display: none;">
      ‚úÖ This invoice is paid in full.
    </div>
  </form>
</div>

<!-- üí∞ Payments Tab -->
<div class="tab-pane fade" id="tab-payments">
  <div class="container">
    <h4 class="mb-3">Log Invoice Payment</h4>
    <form id="logPaymentForm">
      <input type="hidden" id="log-payment-invoiceID">

      <div class="col-md-2 col-lg-2"><label for="log-payment-amount" class="form-label">Amount Received</label><input type="text" class="form-control" id="log-payment-amount" min="0.01" step="0.01" required></div>
      <div class="col-md-2 col-lg-2"><input class="form-control" list="payment-method-options" id="paymentMethod" name="paymentMethod" placeholder="Select or type method"></div>
        <datalist id="payment-method-options"></datalist>
      </div>

      <div class="form-text text-muted mb-3">Partial payments are supported. Balance will update accordingly.</div>
      <div class="d-flex gap-2">
        <button id="recordPaymentBtn" class="btn btn-primary">Record Payment</button>
        <button type="reset" class="btn btn-secondary">Clear</button>
      </div>
    </form>
  </div>
</div>

</div> <!-- END tab-content -->
</div> <!-- END container -->
<!-- üí≥ Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="paymentModalLabel">Record Payment</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="paymentForm">
          <div class="mb-3">
            <label for="paymentAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="paymentAmount" required />
          </div>
          <div class="mb-3">
            <label for="paymentMethodInput" class="form-label">Method</label>
            <input class="form-control" list="payment-method-options" id="paymentMethodInput" name="paymentMethod" placeholder="Select or type method">
            <datalist id="payment-method-options">
              <option value="Cash">
              <option value="Card">
              <option value="Check">
              <option value="Zelle">
              <option value="Venmo">
              <option value="Other">
            </datalist>
          </div>
          <div class="mb-3">
            <label for="paymentDate" class="form-label">Date</label>
            <input type="date" class="form-control" id="paymentDate" />
          </div>
          <div class="mb-3">
            <label for="paymentNote" class="form-label">Note</label>
            <textarea class="form-control" id="paymentNote" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="savePaymentBtn">Save Payment</button>
      </div>
    </div>
  </div>
</div></section>

<!-- <script> -->

<script>

function setupDynamicNavigation() {
  function activateTabFromHash() {
    var hash = window.location.hash;
    if (!hash) return;

    var targetTabButton = document.querySelector('[data-bs-target="' + hash + '"]');
    if (targetTabButton) {
      var tab = new bootstrap.Tab(targetTabButton);
      tab.show();
    }
  }

  // Use window.onload for full page load
  window.onload = function() {
    activateTabFromHash();  // Ensures tab switch happens after everything is loaded
  };

  window.addEventListener('hashchange', activateTabFromHash);
}

setupDynamicNavigation();

</script>

<script src="config.js"></script>
<script src="invoicemanager.js"></script>

<!-- </script> -->

</body>
</html>
