<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ“… FullCalendar Feature Showcase</title>
  <script src="config.js" defer></script>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">ðŸ“… FullCalendar Demo</h1>
    <div class="card shadow rounded-4">
      <div class="card-body p-4">
        <div id="calendar"></div>
      </div>
    </div>
  </div>

<!-- ðŸ“Œ Add/Edit Event Modal -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow rounded-4">
      <div class="modal-header">
        <h5 class="modal-title" id="addEventLabel">Event Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="eventForm">
          <div class="mb-3">
            <label for="eventTitle" class="form-label">Event Title</label>
            <input type="text" class="form-control" id="eventTitle" required>
          </div>
          <input type="hidden" id="eventStart">
          <input type="hidden" id="eventEnd">
          <input type="hidden" id="eventAllDay">
        </form>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-outline-danger" id="deleteEventBtn" style="display: none;">Delete</button>
        <button type="submit" class="btn btn-primary" form="eventForm">Save</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('âœ… DOM Ready: checking FullCalendar...');

    setTimeout(() => {
      const { Calendar } = window.FullCalendar;

      const dayGridPlugin = window.FullCalendar.DayGrid?.default || window.FullCalendar.DayGrid;
      const timeGridPlugin = window.FullCalendar.TimeGrid?.default || window.FullCalendar.TimeGrid;
      const listPlugin = window.FullCalendar.List?.default || window.FullCalendar.List;
      const interactionPlugin = window.FullCalendar.Interaction?.default || window.FullCalendar.Interaction;
      const googleCalendarPlugin = window.FullCalendar.GoogleCalendar?.default || window.FullCalendar.GoogleCalendar;

      if (!Calendar || !dayGridPlugin || !googleCalendarPlugin) {
        console.error('âŒ Required plugins not loaded!');
        return;
      }

      const calendarEl = document.getElementById('calendar');
      if (!calendarEl) {
        console.error('âŒ #calendar element not found!');
        return;
      }

      const calendar = new Calendar(calendarEl, {
        plugins: [dayGridPlugin, timeGridPlugin, listPlugin, interactionPlugin, googleCalendarPlugin],
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        googleCalendarApiKey: 'AIzaSyDMCPotxQCPUqoUbKO-oKaCCj6i4ra56gI',
        events: {
          googleCalendarId: '31e2b4afe118f9629a2acd596385c6e00066ba8c78e701097783fa6a6f2cc4af@group.calendar.google.com'
        },
        selectable: true,
        editable: true,

        select(info) {
          document.getElementById('eventForm').reset();
          document.getElementById('eventStart').value = info.startStr;
          document.getElementById('eventEnd').value = info.endStr;
          document.getElementById('eventAllDay').value = info.allDay;
          document.getElementById('eventForm').dataset.editing = 'false';
          document.getElementById('eventForm').dataset.eventId = '';
          document.getElementById('deleteEventBtn').style.display = 'none';

          const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
          modal.show();
        },

        eventClick(info) {
          const event = info.event;

          document.getElementById('eventTitle').value = event.title;
          document.getElementById('eventStart').value = event.startStr;
          document.getElementById('eventEnd').value = event.endStr || '';
          document.getElementById('eventAllDay').value = event.allDay;

          document.getElementById('eventForm').dataset.editing = 'true';
          document.getElementById('eventForm').dataset.eventId = event.id || event._def.publicId;
          document.getElementById('deleteEventBtn').style.display = 'inline-block';

          const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
          modal.show();
        },

        eventDrop(info) {
          console.log(`ðŸ“¦ Moved '${info.event.title}'`);
        },

        eventResize(info) {
          console.log(`ðŸ”§ Resized '${info.event.title}'`);
        }
      });

      calendar.render();

      document.getElementById('eventForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const title = document.getElementById('eventTitle').value.trim();
        const start = document.getElementById('eventStart').value;
        const end = document.getElementById('eventEnd').value;
        const allDay = document.getElementById('eventAllDay').value === 'true';

        const isEditing = this.dataset.editing === 'true';
        const eventId = this.dataset.eventId;

        if (title) {
          if (isEditing && eventId) {
            const existingEvent = calendar.getEventById(eventId);
            if (existingEvent) {
              existingEvent.setProp('title', title);
              existingEvent.setStart(start);
              existingEvent.setEnd(end || null);
              existingEvent.setAllDay(allDay);
            }
          } else {
            const newId = 'ev-' + Date.now();
            calendar.addEvent({
              id: newId,
              title,
              start,
              end,
              allDay
            });
          }
        }

        const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
        modal.hide();
        calendar.unselect();
        this.reset();
        this.dataset.editing = 'false';
        this.dataset.eventId = '';
      });

      document.getElementById('deleteEventBtn').addEventListener('click', () => {
        const eventId = document.getElementById('eventForm').dataset.eventId;
        const event = calendar.getEventById(eventId);
        if (event) event.remove();

        const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
        modal.hide();
        document.getElementById('eventForm').reset();
      });

      console.log('âœ… Calendar rendered with all plugins and custom modal!');
    }, 300);
  });
</script>


</body>
</html>
