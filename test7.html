<!--  Restore point -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Manager</title>
<style>
/* Hide number input arrows (spinners) */
.part-rows input.qty-input::-webkit-inner-spin-button,
.part-rows input.qty-input::-webkit-outer-spin-button,
#part-rows input.qty-input::-webkit-inner-spin-button,
#part-rows input.qty-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
</style>
</head>
<body class="page-body" style="min-height:100vh;" data-element="page-bg">
<!-- üíß Watermark -->
<div class="watermark"></div>
<!-- üîî Toast Notifications -->
<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

<!-- ‚è≥ Loader -->
<div id="loadingOverlay" class="d-none">
  <div class="text-center">
    <div class="spinner-border" role="status"></div>
    <p class="mt-4">Loading... Please wait...</p>
  </div>
</div>

<!-- Product Management Section -->
<div class="container">
  <h2 class="text-center mb-4">Product Management</h2>

  <!-- üîç Search + Counters -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="input-group w-50">
      <input type="text" id="searchInput" class="form-control" placeholder="üîç Search products...">
    </div>
    <div class="d-flex gap-3">
      <span class="badge bg-primary">Total: <span id="totalCounter">0</span></span>
      <span class="badge bg-danger">Found: <span id="searchCounter">0</span></span>
    </div>
  </div>

  <!-- Shared Part Options Datalist -->
  <datalist id="row-parts-selector"></datalist>

  <!-- ‚ûï Add New Product Accordion -->
  <div class="accordion mb-3" id="addProductAccordion">
    <div class="accordion-item border-info">
      <h2 class="accordion-header" id="heading-addProduct">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapse-addProduct"
                aria-expanded="false"
                aria-controls="collapse-addProduct">
          ‚ûï Add New Product
        </button>
      </h2>
      <div id="collapse-addProduct" class="accordion-collapse collapse"
          aria-labelledby="heading-addProduct"
          data-bs-parent="#addProductAccordion">
        <div class="accordion-body">
          <form id="addProductForm">
            <!-- ===== Product Info Section ===== -->
            <fieldset class="mb-2 p-2 border rounded border-info">
              <legend class="small fw-bold mb-0">
                <div class="row w-100 gx-2">
                  <div class="col-2 text-truncate"><span class="text-info">Product Details</span></div>
                  <div class="col-2 text-truncate">ID # TBD</div>
                <div class="col-6 text-truncate">
                  <span class="text-info">Type:</span> 
                  <span class="productType-legend text-warning"></span>
                  <input type="text" class="form-control form-control-sm productType-input" list="product-type-options" placeholder="Select Type">
                  <datalist id="product-type-options"></datalist>
                </div>
                  <!-- üëá Hardcoded static date -->
                  <div class="col-2 text-truncate"><span class="text-info">Updated:</span> <span class="prodDate text-warning">2025-09-19</span></div>
                </div>
              </legend>

              <div class="row gx-3 gy-1 align-items-center mt-2">
                <div class="col-md-4">
                  <label class="form-label text-info">Product Name</label>
                  <input type="text" class="form-control form-control-sm productName-input" id="productName">
                </div>
              <div class="col-4">
                <label class="form-label">Description</label>
                <span class="description text-warning"></span>
                <textarea class="form-control form-control-sm description-input" rows="1" style="overflow:hidden; resize:none;"></textarea>
              </div>
               <div class="col-md-2">
                  <label class="form-label text-info">Total Cost</label>
                  <input type="text" class="form-control form-control-sm text-warning totalCost-input" style="border: none;" id="totalCost" readonly>
                </div>
                <div class="col-md-2">
                  <label class="form-label text-info">Total Retail</label>
                  <input type="text" class="form-control form-control-sm text-warning totalRetail-input" style="border: none;" id="totalRetail" readonly>
                </div>
              </div>
            </fieldset>

            <!-- ===== Parts Section Accordion ===== -->
            <div class="accordion mt-2 mb-2" id="addProductPartsAccordion">
              <div class="accordion-item border-info">
                <h2 class="accordion-header" id="heading-addProductParts">
                  <button class="accordion-button collapsed" type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapse-addProductParts"
                          aria-expanded="false"
                          aria-controls="collapse-addProductParts">
                    <span><i class="fa-solid fa-tag me-2"></i></span>
                    <span class="fs-6 ms-2" id="partrow-header-display">Parts</span>
                  </button>
                </h2>
                <div id="collapse-addProductParts" class="accordion-collapse collapse"
                    data-bs-parent="#addProductPartsAccordion">
                  <div class="accordion-body">
                    <div class="container-fluid px-0">
                      <div class="row mb-0 part-row-headers">
                        <div class="col-md-6">Part</div>
                        <div class="col-md-1">Qty</div>
                        <div class="col-md-2">Cost $</div>
                        <div class="col-md-2">Retail $</div>
                        <div class="col-md-1"></div>
                      </div>
                      <div id="part-rows" class="part-rows"></div>
                      <div class="row g-3 mt-1 mb-1">
                        <div class="col-sm-6">
                          <button type="button" class="btn" id="add-partRow">‚ûï Part</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Save Button -->
            <div class="row g-3 mt-2 mb-2">
              <div class="col-sm-12 d-flex gap-2">
                <button type="submit" class="btn btn-success btn-sm rounded-pill">üíæ Save</button>
                <button type="button" class="btn btn-secondary btn-sm rounded-pill" id="addProductCancel">‚ùå Cancel</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- üîç Search Results Accordion -->
  <div class="accordion" id="productSearchResults"></div>

  <!-- Template for a single part row (not displayed) -->
  <template id="partRowTemplate">
    <div class="row align-items-center mb-2 part-row">
      <!-- Part Name -->
      <div class="col-md-6">
        <span class="part-name-span text-warning"></span>
        <input type="text" class="form-control form-control-sm part-input d-none" list="row-parts-selector">
      </div>

      <!-- Qty -->
      <div class="col-md-1">
        <span class="part-qty-span text-warning"></span>
        <input type="number" class="form-control form-control-sm qty-input d-none">
      </div>

      <!-- Cost -->
      <div class="col-md-2">
        <span class="part-cost-span text-warning"></span>
        <input type="text" class="form-control form-control-sm text-warning totalRowCost d-none" readonly>
      </div>

      <!-- Retail -->
      <div class="col-md-2">
        <span class="part-retail-span text-warning"></span>
        <input type="text" class="form-control form-control-sm text-warning totalRowRetail d-none" readonly>
      </div>

      <!-- Remove Button -->
      <div class="col-md-1 d-flex">
        <button type="button" class="btn btn-danger btn-sm remove-part">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>
  </template>

  <!-- Template for dynamic product rows -->
  <template id="rowTemplate">
    <div class="accordion-item product-accordion border-info">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse">
          <div class="row w-100 text-truncate align-items-center gx-2">
            <div class="col-1 text-center productType-icon"></div>
            <div class="col-9 text-truncate fw-bold productName"></div>
            <div class="col-2 totalRetail"></div>
          </div>
        </button>
      </h2>

      <div class="accordion-collapse collapse">
        <div class="accordion-body">
<!-- ===== Product Info Section ===== -->
<fieldset id="productInfoFieldset" class="mb-2 p-2 border rounded border-info">

  <!-- Main Content Row -->
  <div class="d-flex flex-wrap justify-content-start align-items-start gap-3">

    <!-- Left Column: Control Panel + Product Name + Thumbnail -->
    <div id="productThumbnailColumn" class="d-flex" style="width:250px; height:250px;">

      <!-- Control Panel -->
      <div id="thumbnailControlPanel" 
           class="d-flex flex-column justify-content-center align-items-center me-2"
           style="width:50px;">
        <button class="btn btn-sm btn-outline-info mb-1" title="Upload"><i class="bi bi-upload"></i></button>
        <button class="btn btn-sm btn-outline-warning mb-1" title="Edit"><i class="bi bi-pencil"></i></button>
        <button class="btn btn-sm btn-outline-danger mb-1" title="Delete"><i class="bi bi-trash"></i></button>
      </div>

      <!-- Thumbnail + Manage Gallery Button -->
      <div class="d-flex flex-column align-items-center">
        <input type="text" class="form-control form-control-sm productName-input mb-1 text-center" 
               id="productName" placeholder="Product Name">
        <img src="/images/placeholder.png" 
             class="img-thumbnail mb-2"
             alt="Product Thumbnail"
             style="width:200px; height:200px;">

        <!-- Manage Gallery Button -->
        <button class="btn btn-sm btn-outline-info" 
                data-bs-toggle="modal" 
                data-bs-target="#imageManagerModal">
          <i class="bi bi-images me-1"></i> Gallery Manager
        </button>
      </div>
    </div>

    <!-- Middle Column: Type + Updated + Description -->
    <div id="productDescriptionColumn" class="d-flex flex-column" style="width:400px; height:200px;">

      <!-- Product Type (inline label + input) -->
      <div class="d-flex align-items-center mb-4">
        <label for="productTypeInput" class="form-label text-info mb-0 me-2">Product Type:</label>
        <input type="text" 
               id="productTypeInput"
               class="form-control form-control-sm productType-input"
               list="product-type-options" 
               placeholder="Select Type" 
               style="max-width: 70%;">
        <datalist id="product-type-options"></datalist>
      </div>

      <!-- Last Updated -->
      <div class="mb-4">
        <small class="text-info fw-bold">Updated:</small> 
        <span id="productUpdated" class="prodDate text-warning">09-19-2025</span>
      </div>

      <!-- Description (single-line look) -->
      <label for="productDescriptionInput" class="form-label mb-1">Description</label>
      <textarea id="productDescriptionInput" 
                class="form-control form-control-sm description-input"
                rows="1"
                style="resize:none; overflow:hidden;"
                placeholder="Enter product description"></textarea>
    </div>

    <!-- Right Column: Totals -->
    <!-- <div id="productTotalsColumn" 
         class="d-flex flex-column align-items-center ps-3 border-start border-2 rounded bg-black shadow-sm"
         style="width:150px; height:200px;">
      <label for="totalCost" class="form-label text-info mb-1">Total Cost</label>
      <input id="totalCost" type="text" 
             class="form-control form-control-sm text-warning mb-2 totalCost-input" 
             readonly>
      <label for="totalRetail" class="form-label text-info mb-1">Total Retail</label>
      <input id="totalRetail" type="text" 
             class="form-control form-control-sm text-warning totalRetail-input" 
             readonly>
    </div> -->

  </div>
</fieldset>

          <!-- Parts Section Accordion -->
          <div class="accordion mt-2 mb-2 parts-accordion">
            <div class="accordion-item border-info">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse">
                  <span><i class="fa-solid fa-boxes-stacked me-2"></i></span>
                  <span class="fs-6 ms-2 partrow-header-display">Parts</span>
                </button>
              </h2>
              <div class="accordion-collapse collapse">
                <div class="accordion-body">
                  <div class="container-fluid px-0">

                    <!-- Headers -->
                    <div class="row mb-0 part-row-headers">
                      <div class="col-md-6">Part</div>
                      <div class="col-md-1">Qty</div>
                      <div class="col-md-2">Cost $</div>
                      <div class="col-md-2">Retail $</div>
                      <div class="col-md-1"></div>
                    </div>

                    <!-- Container for cloned part rows -->
                    <div class="part-rows"></div>

                    <!-- Add Part Button -->
                    <div class="row g-3 mt-1 mb-1">
                      <div class="col-sm-6">
                        <button type="button" class="btn btn-sm btn-outline-primary addPartBtn">‚ûï Part</button>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Buttons -->
          <div class="d-flex gap-1 mt-2">
            <button type="button" class="btn btn-warning btn-sm rounded-pill edit-button">
              <i class="bi bi-pencil me-1"></i> Edit
            </button>
            <button type="button" class="btn btn-success btn-sm rounded-pill save-button d-none" disabled>
              <i class="bi bi-check me-1"></i> Save
            </button>
            <button type="button" class="btn btn-secondary btn-sm rounded-pill cancel-button d-none">
              <i class="bi bi-x me-1"></i> Cancel
            </button>
            <div class="d-flex gap-1">
              <button type="button" class="btn btn-outline-danger btn-sm rounded-pill before-delete-button">Delete</button>
              <button type="button" class="btn btn-danger btn-sm rounded-pill delete-button d-none">Confirm</button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </template>

</div>

<script src="config.js" defer></script> <!-- this has all my glogal functions, variables and constants including scripturl -->
<script src="test7.js" defer></script>

<script>

function setupDynamicNavigation() {
  function activateTabFromHash() {
    var hash = window.location.hash;
    if (!hash) return;

    var targetTabButton = document.querySelector('[data-bs-target="' + hash + '"]');
    if (targetTabButton) {
      var tab = new bootstrap.Tab(targetTabButton);
      tab.show();
    }
  }

  // Use window.onload for full page load
  window.onload = function() {
    activateTabFromHash();  // Ensures tab switch happens after everything is loaded
  };

  window.addEventListener('hashchange', activateTabFromHash);
}

setupDynamicNavigation();

window.addEventListener('DOMContentLoaded', () => {
  const theme = localStorage.getItem('selectedTheme');
  if (theme) {
    document.body.classList.add(theme);
  }
});

</script>

<!-- </script> -->

</body>
</html>
