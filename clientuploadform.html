<input type="file" id="f">
<textarea id="noteInput" placeholder="Note"></textarea>
<button id="b">Upload</button>

<script src="config.js"></script> <!-- Must define scriptURL -->

<script>
const b = document.getElementById("b");
const f = document.getElementById("f");
const noteInput = document.getElementById("noteInput");

b.addEventListener("click", async () => {
  if (!f.files.length) return console.warn("No file selected");

  const file = f.files[0];
  const reader = new FileReader();

  reader.onload = async (e) => {
    const base64Data = e.target.result.split(',')[1]; // remove data: prefix
    const payload = {
      system: "clientUploads",
      action: "saveUploadedFiles",
      clientID: new URLSearchParams(window.location.search).get("clientID"),
      firstName: new URLSearchParams(window.location.search).get("firstName"),
      fileNote: noteInput.value,
      fileName: file.name,
      fileData: base64Data
    };

    try {
      const res = await fetch(scriptURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const result = await res.json();
      if (result.success) {
        console.log("✅ File uploaded successfully", result);
      } else {
        console.error("❌ Upload failed", result);
      }
    } catch (err) {
      console.error(err);
    }
  };

  reader.readAsDataURL(file);
});
</script>
