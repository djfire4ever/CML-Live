<input type="file" id="fileInput">
<button id="uploadBtn">Upload</button>
<div id="status"></div>

<script src="config.js"></script> <!-- your global config with scriptURL -->

<script>
const uploadBtn = document.getElementById("uploadBtn");
const fileInput = document.getElementById("fileInput");
const statusDiv = document.getElementById("status");

uploadBtn.addEventListener("click", async () => {
  const file = fileInput.files[0];
  if (!file) {
    console.warn("No file selected");
    statusDiv.textContent = "‚ùå Please select a file.";
    return;
  }

  const formData = new FormData();
  formData.append("uploadedFile", file);   // must be 'uploadedFile'
  formData.append("system", "clientUploads");
  formData.append("action", "saveUploadedFiles");

  try {
    console.log("üì§ Uploading file‚Ä¶", file.name);
    const res = await fetch(scriptURL, { method: "POST", body: formData });
    const text = await res.text();

    // Log the raw server response
    console.log("üì° Server raw response:", text);

    // Try to parse JSON safely
    let result;
    try {
      result = JSON.parse(text);
    } catch (err) {
      result = { success: false, message: "‚ö†Ô∏è Invalid JSON from server", details: err.message };
    }

    if (result.success) {
      console.log(`‚úÖ File uploaded successfully: ${file.name}`, result);
      statusDiv.textContent = `‚úÖ Uploaded: ${file.name}`;
    } else {
      console.error(`‚ùå Upload failed:`, result);
      statusDiv.textContent = `‚ùå Upload failed: ${result.message}`;
    }

  } catch (err) {
    console.error("Upload error:", err);
    statusDiv.textContent = `‚ùå Upload error: ${err.message}`;
  }
});
</script>
