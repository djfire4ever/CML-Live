<input type="file" id="f">
<button id="b">Upload</button>

<script src="config.js"></script> <!-- Your global config with scriptURL -->

<script>
const b = document.getElementById("b");
const f = document.getElementById("f");

b.addEventListener("click", async () => {
  if (!f.files.length) return console.warn("No file selected");

  const fd = new FormData();
  fd.append("system", "clientUploads");
  fd.append("action", "saveUploadedFiles");
  fd.append("uploadedFile", f.files[0]); // Must be exactly 'uploadedFile' for GAS

  try {
    console.log("üì§ Uploading file‚Ä¶", f.files[0].name);
    const res = await fetch(scriptURL, {
      method: "POST",
      body: fd
      // Do NOT set 'Content-Type' manually; let browser handle it
    });

    const text = await res.text();
    console.log("üì° Server raw response:", text);

    let result;
    try {
      // Apps Script often returns text even if JSON; extract JSON
      const firstBrace = text.indexOf("{");
      const lastBrace = text.lastIndexOf("}");
      result = JSON.parse(text.substring(firstBrace, lastBrace + 1));
    } catch (err) {
      result = { success: false, message: "Invalid JSON from server" };
    }

    if (result.success) {
      console.log(`‚úÖ File uploaded successfully: ${f.files[0].name}`, result);
    } else {
      console.error(`‚ùå Upload failed:`, result);
    }

  } catch (err) {
    console.error("üí• Upload error:", err);
  }
});
</script>
